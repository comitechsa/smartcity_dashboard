<?php
	
	$timestamp = strtotime(date("Y-d-m H:i:s "));
	$json='[{"latitude":35.3283366,"longitude":25.1444412,"time":1587801217761},{"latitude":35.32903678925904,"longitude":25.14300918587824,"time":1587806954097},{"latitude":35.3313712006564,"longitude":25.139607821467248,"time":1587807263352},{"latitude":35.33323023884155,"longitude":25.139382823467127,"time":1587807568599},{"latitude":35.33302894394215,"longitude":25.13950427333686,"time":1587807908364},{"latitude":35.33526804932238,"longitude":25.138809898263776,"time":1587808692876},{"latitude":35.33634960839358,"longitude":25.13480356092454,"time":1587809052057},{"latitude":35.33618879777292,"longitude":25.13477489084893,"time":1587809449209},{"latitude":35.336433490863755,"longitude":25.13493182644099,"time":1587809768003},{"latitude":35.33650434458653,"longitude":25.134991854288984,"time":1587810077294},{"latitude":35.33633239457531,"longitude":25.134937650328755,"time":1587810407592},{"latitude":35.3363956,"longitude":25.1349356,"time":1587810790380},{"latitude":35.3362091941284,"longitude":25.133879728716323,"time":1587811103172},{"latitude":35.334096082578796,"longitude":25.133378095600754,"time":1587811508870},{"latitude":35.32672811666807,"longitude":25.14035685188009,"time":1587811952165},{"latitude":35.32847801816603,"longitude":25.144837436505362,"time":1587812271482},{"latitude":35.329258769104335,"longitude":25.143420730900708,"time":1587813112928},{"latitude":35.32793397391849,"longitude":25.14406428169904,"time":1587813495791},{"latitude":35.31683110172543,"longitude":25.145856684907166,"time":1587813801009},{"latitude":35.31424993582238,"longitude":25.148096922881415,"time":1587814415830},{"latitude":35.322783764895426,"longitude":25.141916322014865,"time":1587814754519},{"latitude":35.32612776193662,"longitude":25.14619920354492,"time":1587815266847},{"latitude":35.327934990089695,"longitude":25.144389215010268,"time":1587815615237},{"latitude":35.3285452994985,"longitude":25.144327501518635,"time":1587816192837},{"latitude":35.328194733324,"longitude":25.144912479349347,"time":1587816722203},{"latitude":35.32838260082368,"longitude":25.144613098469218,"time":1587817070373},{"latitude":35.32838260082368,"longitude":25.144613098469218,"time":1587817370373},{"latitude":35.32838260082368,"longitude":25.144613098469218,"time":1587817670373},{"latitude":35.32838260082368,"longitude":25.144613098469218,"time":1587817970373},{"latitude":35.32838260082368,"longitude":25.144613098469218,"time":1587818270373},{"latitude":35.32838260082368,"longitude":25.144613098469218,"time":1587818570373},{"latitude":35.32838260082368,"longitude":25.144613098469218,"time":1587818870373},{"latitude":35.32838260082368,"longitude":25.144613098469218,"time":1587819170373},{"latitude":35.32838260082368,"longitude":25.144613098469218,"time":1587819470373},{"latitude":35.32838260082368,"longitude":25.144613098469218,"time":1587819770373},{"latitude":35.32838260082368,"longitude":25.144613098469218,"time":1587820070373},{"latitude":35.32838260082368,"longitude":25.144613098469218,"time":1587820370373},{"latitude":35.32838260082368,"longitude":25.144613098469218,"time":1587820670373},{"latitude":35.32838260082368,"longitude":25.144613098469218,"time":1587820970373},{"latitude":35.32838260082368,"longitude":25.144613098469218,"time":1587821270373},{"latitude":35.32838260082368,"longitude":25.144613098469218,"time":1587821570373},{"latitude":35.32838260082368,"longitude":25.144613098469218,"time":1587821870373},{"latitude":35.32838260082368,"longitude":25.144613098469218,"time":1587822170373},{"latitude":35.32838260082368,"longitude":25.144613098469218,"time":1587822470373},{"latitude":35.32838260082368,"longitude":25.144613098469218,"time":1587822770373},{"latitude":35.32838260082368,"longitude":25.144613098469218,"time":1587823070373},{"latitude":35.32838260082368,"longitude":25.144613098469218,"time":1587823370373},{"latitude":35.32838260082368,"longitude":25.144613098469218,"time":1587823670373},{"latitude":35.3283328,"longitude":25.1444466,"time":1587824193213},{"latitude":35.3283328,"longitude":25.1444466,"time":1587824493213},{"latitude":35.3283328,"longitude":25.1444466,"time":1587824793213},{"latitude":35.3283351,"longitude":25.1444348,"time":1587825218739},{"latitude":35.328163523167866,"longitude":25.144916629201436,"time":1587827078023},{"latitude":35.3283325,"longitude":25.1444425,"time":1587990725444},{"latitude":35.32312767707849,"longitude":25.14142887313719,"time":1587995835307},{"latitude":35.32323392014981,"longitude":25.106260524728707,"time":1587996136000},{"latitude":35.304266591569444,"longitude":25.073695483239117,"time":1587996791847},{"latitude":35.30435372276268,"longitude":25.073577217574417,"time":1587997174321},{"latitude":35.30440254069706,"longitude":25.073543058277373,"time":1587997502772},{"latitude":35.30448430019276,"longitude":25.073511200671962,"time":1587997850195},{"latitude":35.304433329519405,"longitude":25.07349918291217,"time":1587998169485},{"latitude":35.30423944491345,"longitude":25.07333156157048,"time":1587998485691},{"latitude":35.30444670287257,"longitude":25.073149411296374,"time":1587998853708},{"latitude":35.30410319673023,"longitude":25.073793175487214,"time":1587999169958},{"latitude":35.30417283177444,"longitude":25.073465706490683,"time":1587999511697},{"latitude":35.30461659328834,"longitude":25.073805016033994,"time":1587999821891},{"latitude":35.30447646297624,"longitude":25.073223246528563,"time":1588000335982},{"latitude":35.304255071031825,"longitude":25.07350245924864,"time":1588000712083},{"latitude":35.304506943640845,"longitude":25.072900687733405,"time":1588001208749},{"latitude":35.30444643265505,"longitude":25.073422689149133,"time":1588001531001},{"latitude":35.304177395478725,"longitude":25.07320875504293,"time":1588001907992},{"latitude":35.30450892685801,"longitude":25.07311185813127,"time":1588002229172},{"latitude":35.30465286632698,"longitude":25.073118283180648,"time":1588002562038},{"latitude":35.30376591869469,"longitude":25.073535443981164,"time":1588003064662},{"latitude":35.30436464975481,"longitude":25.073283298639193,"time":1588003610861},{"latitude":35.304579657720595,"longitude":25.07359085815736,"time":1588003951729},{"latitude":35.304372917848205,"longitude":25.072963439976117,"time":1588004311747},{"latitude":35.304670405427245,"longitude":25.073423897918403,"time":1588004681032},{"latitude":35.304501120460955,"longitude":25.073287334636554,"time":1588005011978},{"latitude":35.3039763614469,"longitude":25.073282513708826,"time":1588005425671},{"latitude":35.304286972872525,"longitude":25.073617113159983,"time":1588005740878},{"latitude":35.307959598143626,"longitude":25.08968060229355,"time":1588006091609},{"latitude":35.3241205447329,"longitude":25.103360554739687,"time":1588006407516},{"latitude":35.32414841252265,"longitude":25.14357296175902,"time":1588006744950},{"latitude":35.3247805232501,"longitude":25.143071537250716,"time":1588007049152},{"latitude":35.32520393216004,"longitude":25.141455677249844,"time":1588007547545},{"latitude":35.32779838362773,"longitude":25.144036679360095,"time":1588007968168}]';
	$data = json_decode($json);
	for($i=0; $i<sizeof($data); $i++){
		$str.='{"lat":"'.$data[$i]->latitude.'","lng":"'.$data[$i]->longitude.'","time":"'.$data[$i]->time.'"}';
		if($i<(sizeof($data))-1) $str.=',';
	}
	$str.=']';
	echo $str;


	//$arr = implode(",",$_GET);
	$arr='';
	foreach ($_GET as $key => $val){
		$arr.=$key.'->'.$val.';';
	}
	//echo $arr;
	$log =  '==='.substr($_GET['weight'], 2,3).date("Y-d-m H:i:s ")." ".$arr."\n";
	file_put_contents('./log.log', $log, FILE_APPEND);
	
	//2019 05 11 13:00:10  weight->;dategps->051119;course->255;adc2->0;adc1->0;
	//status_info->36665422 59;speed->32;rpm->0;odometer->36665422;latitude->4054.0510;input->1111111111111111;NS->N;cell_info->;power->287;status_id->0;validity->A;fuel->0;
	//EW->E;timegps->105944;longitude->02331.9343;gpsID->8505;output->00000000;temper->0;
	
	$gpsdate=substr($_GET['dategps'],4,2).'-'.substr($_GET['dategps'],2,2).'-'.substr($_GET['dategps'],0,2).' '.substr($_GET['timegps'],0,2).':'.substr($_GET['timegps'],2,2).':'.substr($_GET['timegps'],4,2);
	$latlng=$_GET['latitude'].','.$_GET['longitude'];
		//$newLat=intval($_GET['latitude']/100)+($_GET['latitude']-((intval($_GET['latitude']/100)*100)/60));
		//$newLng=intval($_GET['longitude']/100)+($_GET['longitude']-((intval($_GET['longitude']/100)*100)/60));
		
		$newLat=intval($_GET['latitude']/100)+(($_GET['latitude']-(intval($_GET['latitude']/100)*100))/60);
		$newLng=intval($_GET['longitude']/100)+(($_GET['longitude']-(intval($_GET['longitude']/100)*100))/60);
		//4016.6094,02230.5403
	$fuel_norm=0;
	if(intval($_GET['status_id'])==33){
		$arr=explode(" ", $_GET['status_info']);
		//$newArr=array();
		$counter=0;
		$total=0;
		$flag=0;
		foreach ($arr as $val) {
		  $total=$total+$val;
		  $counter++;
		  if($val==0) $flag=1;
		}
		if($flag==0){
			$fuel_norm=number_format($total/$counter/1000,4);
		}
	}
	
	//if($_REQUEST['status_id']=='390'){
		
	//}
	$host="localhost";
	$user="wangrjz_weighing";
	$database="wangrjz_weighing";
	$pass="qwe#123!@#";
	mysql_set_charset('utf8');
	$connection=mysql_connect($host,$user,$pass) or die ("could not connect");
	$db=mysql_select_db($database,$connection) or die ("could not connect to database");
	mysql_set_charset('utf8');
		$resultRows= mysql_query("SELECT * FROM data");
		$totalRows = mysql_num_rows($resultRows);
		
		$query = "INSERT INTO data(date_insert, weight, gpsdate, course, adc1, adc2, status_info, speed, odometer, latlng, input, NS, cell_info, power, status_id, validity, fuel, EW, gpsID, output, temper, fuel_norm) VALUES ('".date("Y-m-d H:i:s")."','".substr($_GET['weight'], 2,3)."','".$gpsdate."','".$_GET['course']."','".$_GET['adc1']."','".$_GET['adc2']."','".$_GET['status_info']."','".$_GET['speed']."','".$_GET['odometer']."','".$latlng."','".$_GET['input']."','".$_GET['NS']."','".$_GET['cell_info']."','".$_GET['power']."','".$_GET['status_id']."','".$_GET['validity']."','".$_GET['fuel']."','".$_GET['EW']."','".$_GET['gpsID']."','".$_GET['output']."','".$_GET['temper']."','".$fuel_norm."')";
		file_put_contents('./log.log', $query, FILE_APPEND);
		$result= mysql_query($query) or die ("could not execute");
		$resultRowsEnd= mysql_query("SELECT * FROM data");
		$totalRowsEnd = mysql_num_rows($resultRowsEnd);
		if($totalRows==$totalRowsEnd) {
			file_put_contents('./log.log', 'Error:::'.$query, FILE_APPEND);
		} else {
			//SERVER_DOMAIN/api/api_loc.php?imei=123456789012345&dt=2016-01-01 00:00:00&lat=54.000000&lng=25.000000&altitude=100&angle=45&speed=60&loc_valid=1
			//A9BC5E7046D99082228F0FDF1B6A3A2D api key
			//3403
			//if($_GET['gpsID']==3403)$apikey='A9BC5E7046D99082228F0FDF1B6A3A2D'; //Edsna
			//if($_GET['gpsID']==8505)$apikey='A9BC5E7046D99082228F0FDF1B6A3A2D'; //Visaltia
			//if($_GET['gpsID']==3403||$_GET['gpsID']==8505){
						//https://gsh4.net/id31/api/api_loc.php?imei=3403&dt='.$gpsdate.'&lat='.$_GET['latitude'].'&lng='$_GET['longitude'].'&altitude=0&angle=0&speed='.$_GET['speed'].'&loc_valid=1
				//file_get_contents('https://gsh4.net/id31/api/api_loc.php?imei='.$_GET['gpsID'].'&dt='.$gpsdate.'&lat='.$_GET['latitude'].'&lng='$_GET['longitude'].'&altitude=0&angle=0&speed='.$_GET['speed'].'&loc_valid=1');
				//file_get_contents('https://gsh4.net/id31/api/api_loc.php?imei=3403&dt=2019-11-13 07:48:04&lat=3801.9189&lng=02342.9247&altitude=0&angle=0&speed=51&loc_valid=1');
			//}
			//echo 'https://gsh4.net/id31/api/api_loc.php?imei='.$_GET['gpsID'].'&dt='.$gpsdate.'&lat='.$newLat.'&lng='.$newLng.'&altitude=0&angle=0&speed='.$_GET['speed'].'&loc_valid=1';
			if(intval($_GET['gpsID'])>0 && intval($newLat)>0 && intval($newLng)>0){
				$postUrl=str_replace(" ","%20",'https://gsh4.net/id31/api/api_loc.php?imei='.$_GET['gpsID'].'&dt=20'.$gpsdate.'&lat='.$newLat.'&lng='.$newLng.'&altitude=0&angle=0&speed='.$_GET['speed'].'&loc_valid=1');
				//$resp = file_get_contents('https://gsh4.net/id31/api/api_loc.php?imei='.$_GET['gpsID'].'&dt=20'.$gpsdate.'&lat='.$newLat.'&lng='.$newLng.'&altitude=0&angle=0&speed='.$_GET['speed'].'&loc_valid=1');
				$resp = file_get_contents($postUrl);
				$gpsServer = $resp.'--'.$postUrl.'--';
				//$gpsServer = $resp.'--'.'https://gsh4.net/id31/api/api_loc.php?imei='.$_GET['gpsID'].'&dt=20'.$gpsdate.'&lat='.$newLat.'&lng='.$newLng.'&altitude=0&angle=0&speed='.$_GET['speed'].'&loc_valid=1'.'--';
				file_put_contents('./log.log', 'Fleeto:::'.$gpsServer, FILE_APPEND);								
			}

		}
	mysql_close($connection);
	//https://gsh4.net/id31/api/api_loc.php?imei=3403&dt=2019-11-14 20:45:15&lat=37.988245&lng=23.783705&altitude=0&angle=0&speed=0&loc_valid=1
	//$resp = file_get_contents('https://gsh4.net/id31/api/api_loc.php?imei='.$_GET['gpsID'].'&dt=20'.$gpsdate.'&lat='.$newLat.'&lng='.$newLng.'&altitude=0&angle=0&speed='.$_GET['speed'].'&loc_valid=1');
?>
<?php
//exit;
	$host="localhost";
	$user="wangrjz_edsna";
	$database="wangrjz_edsna";
	$pass="qwe#123!@#";
	mysql_set_charset('utf8');
	$connection=mysql_connect($host,$user,$pass) or die ("could not connect");
	$db=mysql_select_db($database,$connection) or die ("could not connect to database");
	mysql_set_charset('utf8');
	
	//$txt=$_REQUEST['str'];
	//$txt=$_POST[str];
	$txt=file_get_contents('php://input');
	$txt=str_replace("'","`",$txt);
	//$decoded=json_decode($txt);
	//$txt=json_decode($txt);
	//$log =$txt."\n";
	
	file_put_contents('log.log', $txt, FILE_APPEND);
	//echo $decoded['str'][0]['VehicleIID'];
	//echo Array ( [str] => Array ( [0] => Array ( [IID]
	//{"str":[{"IID":1,"VehicleIID":540,"HandlingIID":1,"Custom
	
	//$array_var = unserialize(base64_decode($txt));

//$txt='{"str":[{"IID":1,"VehicleIID":540,"HandlingIID":1,"CustomerIID":86,"MaterialIID":1,"TransDestIID":1,"GateIIDIn":3,"DateIn":{"date":"2017-01-02 06:02:39","timezone_type":3,"timezone":"Europe\/Berlin"},"GateWrkIIDIn":27,"GateIIDOut":5,"DateOut":{"date":"2017-01-02 06:25:57","timezone_type":3,"timezone":"Europe\/Berlin"},"GateWrkIIDOut":41,"GrossWeight":15290,"TareWeight":10030,"NetWeight":5260,"WBGrossWeight":15290,"WBTareWeight":10030,"WeightVehOnExit":1,"CommandBarCode":null,"CommandIID":null,"IsNotActive":0,"InvoiceIID":null,"Notes":"","Bypass":0,"CmdExpectedWeight":null,"Inspected":0},{"IID":2,"VehicleIID":248,"HandlingIID":1,"CustomerIID":86,"MaterialIID":1,"TransDestIID":1,"GateIIDIn":3,"DateIn":{"date":"2017-01-02 06:03:23","timezone_type":3,"timezone":"Europe\/Berlin"},"GateWrkIIDIn":27,"GateIIDOut":5,"DateOut":{"date":"2017-01-02 06:27:28","timezone_type":3,"timezone":"Europe\/Berlin"},"GateWrkIIDOut":41,"GrossWeight":20450,"TareWeight":11880,"NetWeight":8570,"WBGrossWeight":20450,"WBTareWeight":11880,"WeightVehOnExit":1,"CommandBarCode":null,"CommandIID":null,"IsNotActive":0,"InvoiceIID":null,"Notes":"","Bypass":0,"CmdExpectedWeight":null,"Inspected":0},{"IID":3,"VehicleIID":1020,"HandlingIID":1,"CustomerIID":39,"MaterialIID":1,"TransDestIID":1,"GateIIDIn":3,"DateIn":{"date":"2017-01-02 06:03:59","timezone_type":3,"timezone":"Europe\/Berlin"},"GateWrkIIDIn":27,"GateIIDOut":5,"DateOut":{"date":"2017-01-02 06:28:02","timezone_type":3,"timezone":"Europe\/Berlin"},"GateWrkIIDOut":41,"GrossWeight":22490,"TareWeight":12820,"NetWeight":9670,"WBGrossWeight":22490,"WBTareWeight":12820,"WeightVehOnExit":1,"CommandBarCode":null,"CommandIID":null,"IsNotActive":0,"InvoiceIID":null,"Notes":"","Bypass":0,"CmdExpectedWeight":null,"Inspected":0},{"IID":4,"VehicleIID":2774,"HandlingIID":1,"CustomerIID":97,"MaterialIID":1,"TransDestIID":1,"GateIIDIn":2,"DateIn":{"date":"2017-01-02 06:04:30","timezone_type":3,"timezone":"Europe\/Berlin"},"GateWrkIIDIn":40,"GateIIDOut":5,"DateOut":{"date":"2017-01-02 06:25:07","timezone_type":3,"timezone":"Europe\/Berlin"},"GateWrkIIDOut":41,"GrossWeight":24460,"TareWeight":13110,"NetWeight":11350,"WBGrossWeight":24460,"WBTareWeight":13110,"WeightVehOnExit":1,"CommandBarCode":null,"CommandIID":null,"IsNotActive":0,"InvoiceIID":null,"Notes":"","Bypass":0,"CmdExpectedWeight":null,"Inspected":0},{"IID":5,"VehicleIID":1736,"HandlingIID":1,"CustomerIID":86,"MaterialIID":1,"TransDestIID":1,"GateIIDIn":3,"DateIn":{"date":"2017-01-02 06:04:36","timezone_type":3,"timezone":"Europe\/Berlin"},"GateWrkIIDIn":27,"GateIIDOut":5,"DateOut":{"date":"2017-01-02 06:21:19","timezone_type":3,"timezone":"Europe\/Berlin"},"GateWrkIIDOut":41,"GrossWeight":19900,"TareWeight":12950,"NetWeight":6950,"WBGrossWeight":19900,"WBTareWeight":12950,"WeightVehOnExit":1,"CommandBarCode":null,"CommandIID":null,"IsNotActive":0,"InvoiceIID":null,"Notes":"","Bypass":0,"CmdExpectedWeight":null,"Inspected":0},{"IID":6,"VehicleIID":2934,"HandlingIID":8,"CustomerIID":1141,"MaterialIID":12,"TransDestIID":5,"GateIIDIn":3,"DateIn":{"date":"2017-01-02 06:05:22","timezone_type":3,"timezone":"Europe\/Berlin"},"GateWrkIIDIn":27,"GateIIDOut":5,"DateOut":{"date":"2017-01-02 06:19:53","timezone_type":3,"timezone":"Europe\/Berlin"},"GateWrkIIDOut":41,"GrossWeight":15480,"TareWeight":41160,"NetWeight":-25680,"WBGrossWeight":15480,"WBTareWeight":41160,"WeightVehOnExit":1,"CommandBarCode":null,"CommandIID":null,"IsNotActive":0,"InvoiceIID":null,"Notes":null,"Bypass":0,"CmdExpectedWeight":null,"Inspected":0},{"IID":7,"VehicleIID":1830,"HandlingIID":1,"CustomerIID":97,"MaterialIID":1,"TransDestIID":1,"GateIIDIn":2,"DateIn":{"date":"2017-01-02 06:05:22","timezone_type":3,"timezone":"Europe\/Berlin"},"GateWrkIIDIn":40,"GateIIDOut":5,"DateOut":{"date":"2017-01-02 06:23:31","timezone_type":3,"timezone":"Europe\/Berlin"},"GateWrkIIDOut":41,"GrossWeight":20770,"TareWeight":12990,"NetWeight":7780,"WBGrossWeight":20770,"WBTareWeight":12990,"WeightVehOnExit":1,"CommandBarCode":null,"CommandIID":null,"IsNotActive":0,"InvoiceIID":null,"Notes":"","Bypass":0,"CmdExpectedWeight":null,"Inspected":0},{"IID":8,"VehicleIID":1024,"HandlingIID":1,"CustomerIID":39,"MaterialIID":1,"TransDestIID":1,"GateIIDIn":2,"DateIn":{"date":"2017-01-02 06:06:01","timezone_type":3,"timezone":"Europe\/Berlin"},"GateWrkIIDIn":40,"GateIIDOut":5,"DateOut":{"date":"2017-01-02 06:29:21","timezone_type":3,"timezone":"Europe\/Berlin"},"GateWrkIIDOut":41,"GrossWeight":20260,"TareWeight":13150,"NetWeight":7110,"WBGrossWeight":20260,"WBTareWeight":13150,"WeightVehOnExit":1,"CommandBarCode":null,"CommandIID":null,"IsNotActive":0,"InvoiceIID":null,"Notes":"","Bypass":0,"CmdExpectedWeight":null,"Inspected":0},{"IID":9,"VehicleIID":1227,"HandlingIID":1,"CustomerIID":38,"MaterialIID":1,"TransDestIID":1,"GateIIDIn":3,"DateIn":{"date":"2017-01-02 06:06:11","timezone_type":3,"timezone":"Europe\/Berlin"},"GateWrkIIDIn":27,"GateIIDOut":5,"DateOut":{"date":"2017-01-02 06:24:14","timezone_type":3,"timezone":"Europe\/Berlin"},"GateWrkIIDOut":41,"GrossWeight":29300,"TareWeight":15220,"NetWeight":14080,"WBGrossWeight":29300,"WBTareWeight":15220,"WeightVehOnExit":1,"CommandBarCode":null,"CommandIID":null,"IsNotActive":0,"InvoiceIID":null,"Notes":"","Bypass":0,"CmdExpectedWeight":null,"Inspected":0},{"IID":10,"VehicleIID":253,"HandlingIID":1,"CustomerIID":86,"MaterialIID":1,"TransDestIID":1,"GateIIDIn":2,"DateIn":{"date":"2017-01-02 06:06:47","timezone_type":3,"timezone":"Europe\/Berlin"},"GateWrkIIDIn":40,"GateIIDOut":5,"DateOut":{"date":"2017-01-02 06:29:58","timezone_type":3,"timezone":"Europe\/Berlin"},"GateWrkIIDOut":41,"GrossWeight":21240,"TareWeight":11540,"NetWeight":9700,"WBGrossWeight":21240,"WBTareWeight":11540,"WeightVehOnExit":1,"CommandBarCode":null,"CommandIID":null,"IsNotActive":0,"InvoiceIID":null,"Notes":"","Bypass":0,"CmdExpectedWeight":null,"Inspected":0}]}';
$decodedText = html_entity_decode($txt);
$myArray = json_decode($decodedText, true);
$myArray2 =$myArray['str'];

//print_r($myArray2);

//echo $myArray['str'][0]['VehicleIID'];
//echo sizeof($myArray2);
//echo $myArray2[0]['VehicleIID'];
foreach($myArray2 as $val){
	//echo $val['VehicleIID'].'<br>';
	if($val['DateIn']['date']!=''){
		$phpdate = strtotime($val['DateIn']['date']);	
	} else if($val['DateOut']['date']!=''){ {
		$phpdate = strtotime($val['DateOut']['date']);
	}
	
	$yesterday=(strtotime('-3 hour'));
	if($phpdate>$yesterday){
		exit;
	} 
	
	$query = "INSERT INTO crossings(customertype_id,OwnerIID,PlateNo,installation_id, IID, vehicleIID, HandlingIID, CustomerIID, MaterialIID, TransDestIID, DateIn, DateOut, GrossWeight, TareWeight, NetWeight, WeightVehOnExit, IsNotActive, Notes, VehPlateNo, Bypass, Inspected,date_insert) 
	VALUES ('".$val['CstType']."','".$val['OwnerIID']."','".$val['PlateNo']."','".$val['installation']."','".$val['IID']."','".$val['VehicleIID']."','".$val['HandlingIID']."','".$val['CustomerIID']."','".$val['MaterialIID']."','".$val['TransDestIID']."','".$val['DateIn']['date']."','".$val['DateOut']['date']."','".$val['GrossWeight']."','".$val['TareWeight']."','".$val['NetWeight']."','".$val['WeightVehOnExit']."','".$val['IsNotActive']."','".$val['Notes']."','".$val['VehPlateNo']."','".$val['Bypass']."','".$val['Inspected']."','".date('Y-m-d H:i:s')."')"; 
	//file_put_contents('log.log', $query, FILE_APPEND);
	$result= mysql_query($query) or die ("could not execute2");
}
mysql_close($connection);
echo 'Done';
//$decodedText = html_entity_decode($ttt);
//$myArray = json_decode($decodedText, true);
//print_r($myArray);
//echo $myArray['str'][0]['VehicleIID'];
?>