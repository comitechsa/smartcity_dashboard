!function(e){"use strict";var t=function(t){var l=e.Deferred(),n=new FileReader;return n.onload=function(e){l.resolve(e.target.result)},n.onerror=l.reject,n.onprogress=l.notify,n.readAsDataURL(t),l.promise()};e.fn.cleanHtml=function(){var t=e(this).html();return t&&t.replace(/(<br>|\s|<div><br><\/div>|&nbsp;)*$/,"")},e.fn.wysiwyg=function(l){var n,i,a,o=this,r=function(){i.activeToolbarClass&&e(i.toolbarSelector).find(a).each(function(){var t=e(this).data(i.commandRole);document.queryCommandState(t)?e(this).addClass(i.activeToolbarClass):e(this).removeClass(i.activeToolbarClass)})},s=function(e,t){var l=e.split(" "),n=l.shift(),i=l.join(" ")+(t||"");document.execCommand(n,0,i),r()},c=function(t){e.each(t,function(e,t){o.keydown(e,function(e){o.attr("contenteditable")&&o.is(":visible")&&(e.preventDefault(),e.stopPropagation(),s(t))}).keyup(e,function(e){o.attr("contenteditable")&&o.is(":visible")&&(e.preventDefault(),e.stopPropagation())})})},u=function(){var e=window.getSelection();return e.getRangeAt&&e.rangeCount?e.getRangeAt(0):void 0},d=function(){n=u()},h=function(){var e=window.getSelection();if(n){try{e.removeAllRanges()}catch(t){document.body.createTextRange().select(),document.selection.empty()}e.addRange(n)}},f=function(l){o.focus(),e.each(l,function(l,n){/^image\//.test(n.type)?e.when(t(n)).done(function(e){s("insertimage",e)}).fail(function(e){i.fileUploadError("file-reader",e)}):i.fileUploadError("unsupported-file-type",n.type)})},p=function(e,t){h(),document.queryCommandSupported("hiliteColor")&&document.execCommand("hiliteColor",0,t||"transparent"),d(),e.data(i.selectionMarker,t)},m=function(t,l){t.find(a).click(function(){h(),o.focus(),s(e(this).data(l.commandRole)),d()}),t.find("[data-toggle=dropdown]").click(h),t.find("input[type=text][data-"+l.commandRole+"]").on("webkitspeechchange change",function(){var t=this.value;this.value="",h(),t&&(o.focus(),s(e(this).data(l.commandRole),t)),d()}).on("focus",function(){var t=e(this);t.data(l.selectionMarker)||(p(t,l.selectionColor),t.focus())}).on("blur",function(){var t=e(this);t.data(l.selectionMarker)&&p(t,!1)}),t.find("input[type=file][data-"+l.commandRole+"]").change(function(){h(),"file"===this.type&&this.files&&this.files.length>0&&f(this.files),d(),this.value=""})},g=function(){o.on("dragenter dragover",!1).on("drop",function(e){var t=e.originalEvent.dataTransfer;e.stopPropagation(),e.preventDefault(),t&&t.files&&t.files.length>0&&f(t.files)})};return i=e.extend({},e.fn.wysiwyg.defaults,l),a="a[data-"+i.commandRole+"],button[data-"+i.commandRole+"],input[type=button][data-"+i.commandRole+"]",c(i.hotKeys),i.dragAndDropImages&&g(),m(e(i.toolbarSelector),i),o.attr("contenteditable",!0).on("mouseup keyup mouseout",function(){d(),r()}),e(window).bind("touchend",function(e){var t=o.is(e.target)||o.has(e.target).length>0,l=u(),n=l&&l.startContainer===l.endContainer&&l.startOffset===l.endOffset;(!n||t)&&(d(),r())}),this},e.fn.wysiwyg.defaults={hotKeys:{"ctrl+b meta+b":"bold","ctrl+i meta+i":"italic","ctrl+u meta+u":"underline","ctrl+z meta+z":"undo","ctrl+y meta+y meta+shift+z":"redo","ctrl+l meta+l":"justifyleft","ctrl+r meta+r":"justifyright","ctrl+e meta+e":"justifycenter","ctrl+j meta+j":"justifyfull","shift+tab":"outdent",tab:"indent"},toolbarSelector:"[data-role=editor-toolbar]",commandRole:"edit",activeToolbarClass:"btn-info",selectionMarker:"edit-focus-marker",selectionColor:"darkgrey",dragAndDropImages:!0,fileUploadError:function(e,t){console.log("File upload error",e,t)}}}(window.jQuery);